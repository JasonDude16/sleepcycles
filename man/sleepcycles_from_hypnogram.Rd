% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sleepcycles_from_hypnogram.R
\name{sleepcycles_from_hypnogram}
\alias{sleepcycles_from_hypnogram}
\title{Extract Sleep Cycles from a Hypnogram}
\usage{
sleepcycles_from_hypnogram(
  df,
  epoch_col,
  stage_col,
  method = "dude",
  options = list(),
  id_col = NULL,
  verbose = TRUE
)
}
\arguments{
\item{df}{A data frame containing sleep staging data.}

\item{epoch_col}{A string specifying the column name for sleep epochs (must be numeric and sequential).}

\item{stage_col}{A string specifying the column name representing sleep stages.}

\item{method}{The algorithm used for detecting sleep cycles. Options:
\itemize{
\item \code{"dude"} (default) - Uses density-based clustering for defining cycles.
\item \code{"feinberg"} - Uses traditional rule-based heuristics for cycle segmentation.
}}

\item{options}{A named list containing algorithm-specific parameters. If left empty, default parameters are used.
\itemize{
\item \strong{DUDE Algorithm Options}:
\itemize{
\item \code{"sleep_levels"}: Vector of valid sleep stages (default: \code{c("N1", "N2", "N3", "R")}).
\item \code{"combos"}: Defines merged stages (e.g., \code{list("N2_N3" = c("N2", "N3"))}).
\item \code{"NREMP"}: Named list defining \strong{NREM Period (NREMP) detection} parameters:
\itemize{
\item \code{"density_col"}: Column used for NREMP detection (default: \code{"N2_N3"}).
\item \code{"threshold"}: Threshold for cycle classification (default: \code{0.5}).
\item \code{"min_gap"}: Minimum gap between cycles (default: \code{20} epochs).
\item \code{"min_size"}: Minimum cycle duration (default: \code{20} epochs).
}
\item \code{"REMP"}: Named list defining \strong{REM Period (REMP) detection} parameters:
\itemize{
\item \code{"density_col"}: Column used for REMP detection (default: \code{"R"}).
\item \code{"threshold"}: Threshold for cycle classification (default: \code{0.5}).
\item \code{"min_gap"}: Minimum gap between cycles (default: \code{15} epochs).
\item \code{"min_size"}: Minimum cycle duration (default: \code{10} epochs).
}
\item \code{"kernel"}: A Gaussian kernel used for smoothing sleep stage transitions.
}
\item \strong{Feinberg Algorithm Options}:
\itemize{
\item \code{"sleepstart"}: Defines when sleep begins (\code{"N1"} or \code{"N2"}, default: \code{"N1"}).
\item \code{"treat_as_W"}: Defines which stage should be treated as wakefulness (default: \code{"A"}).
\item \code{"rm_incomplete_period"}: Whether to remove incomplete cycles (default: \code{FALSE}).
\item \code{"REMP_length"}: Minimum REM duration for it to be considered a valid cycle (default: \code{10} epochs).
\item \code{"sleep_levels"}: Vector of sleep stages included in cycles (default: \code{c("N1", "N2", "N3", "R")}).
}
}}

\item{id_col}{(Optional) A string specifying the column name for subject IDs. If provided, the function processes each subject separately.}

\item{verbose}{Logical. If \code{TRUE} (default), the function prints warnings and messages when issues occur in grouped data.}
}
\value{
An object of class \code{"SleepCycle"}, which is a list containing:
\itemize{
\item \code{epoch}: A data frame with per-epoch cycle classifications.
\item \code{summary}: A summary of detected cycles with their start and end epochs.
\item \code{info}: A list of metadata including the method used, selected options, and sleep stage levels.
}
}
\description{
This function detects sleep cycles from a \strong{hypnogram} using one of two algorithms:
\itemize{
\item \strong{DUDE} (Density-Based Underlying Dynamics of Epochs): Uses sleep stage densities to define sleep cycles.
\item \strong{Feinberg} (Classic Feinberg & Floyd method): Uses rule-based classification for defining cycles.
}
}
\details{
It processes \strong{both single-subject and multi-subject data}. For grouped data (multiple IDs), it applies the selected method separately to each subject.

The function first validates the input hypnogram using \code{check_hypnogram()}, ensuring correct format and no missing values.
Then, based on the chosen \strong{method}, it calls either \code{.sleepcycles_from_hypnogram_dude()} or \code{.sleepcycles_from_hypnogram_feinberg()} to process the data.

If \code{id_col} is provided, the function runs the cycle detection \strong{independently for each subject} and combines the results.
}
